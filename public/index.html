<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Самый уютный халат-кимоно 2025</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            min-height: 100vh;
            padding: 20px 10px;
            color: #333;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 34px;
            margin-bottom: 10px;
            color: #be185d;
        }
        .subtitle {
            text-align: center;
            font-size: 19px;
            color: #be185d;
            margin-bottom: 20px;
        }
        .descript {
            text-align: right;
            font-size: 14px;
            color: #be185d;
            margin-bottom: 50px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 28px;
        }
        .card {
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 12px 35px rgba(190,24,93,0.18);
            transition: all 0.4s ease;
            cursor: pointer;
        }
        .card:hover { transform: translateY(-15px); box-shadow: 0 25px 50px rgba(190,24,93,0.3); }
        .card.selected { outline: 6px solid #ec4899; transform: translateY(-15px); }
        .card img {
            width: 100%;
            height: 380px;
            object-fit: cover;
        }
        .brand {
            padding: 24px;
            text-align: center;
            font-size: 22px;
            font-weight: 900;
            color: #4c1d95;
        }
        .btn {
            display: block;
            margin: 60px auto 20px;
            background: #ec4899;
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 22px;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 12px 35px rgba(236,72,153,0.5);
            transition: 0.3s;
        }
        .btn:hover { background: #db2777; transform: translateY(-4px); }
        .btn:disabled { background: #fda4af; cursor: not-allowed; transform: none; }
        .thanks {
            text-align: center;
            font-size: 26px;
            font-weight: 900;
            color: #ec4899;
            opacity: 0;
            transition: 0.5s;
        }
        .already-voted { color: #d9469e; font-size: 22px; margin-top: 20px; }

/* === Стиль попапа === */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: white;
            border-radius: 28px;
            padding: 40px 30px;
            text-align: center;
            max-width: 90%;
            width: 420px;
            box-shadow: 0 20px 60px rgba(236,72,153,0.4);
            transform: scale(0.7);
            transition: transform 0.4s ease;
        }
        .modal-overlay.show .modal {
            transform: scale(1);
        }
        .modal h2 {
            font-size: 28px;
            color: #be185d;
            margin-bottom: 16px;
        }
        .modal p {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }
        .modal-btn {
            background: #ec4899;
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
        }
        .modal-btn:hover { background: #db2777; }

      .full-modal {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease;
        padding: 15px; /* отступы на маленьких экранах */
    }
    .full-modal.show {
        opacity: 1;
        visibility: visible;
    }

    .modal-wrapper {
        position: relative;
        width: 95%;
        max-width: 520px;
        height: 90vh;
        max-height: 800px;
        background: white;
        border-radius: 32px;
        overflow: hidden;
        box-shadow: 0 30px 80px rgba(236,72,153,0.5);
    }

    .full-modal iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 32px;
    }

    /* Крестик — теперь внутри окна */
    .close-full-modal {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.9);
        color: #c71585;
        font-size: 32px;
        font-weight: bold;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: all 0.2s;
    }
    .close-full-modal:hover {
        background: #ff69b4;
        color: white;
        transform: scale(1.1);
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ваш выбор 2025 года?</h1>
        <p class="subtitle">Кликни на фото самого уютного и проголосуй ❤️</p>
        <p class="descript">Кимоно воплощает философию комфорта и народной культуры</p>
        
        <div class="grid">
            <!-- Victoria's Secret кимоно -->
            <div class="card" data-brand="Gretz">
                <img src="../src/participant1.webp" alt="Гретз кимоно">
                <div class="brand">Гретз</div>
            </div>

            <!-- Zara Home кимоно -->
            <div class="card" data-brand="Ladoga">
                <img src="../src/participant2.webp" alt="Ветер Ладоги кимоно">
                <div class="brand">Ветер Ладоги</div>
            </div>

            <!-- H&M Home кимоно -->
            <div class="card" data-brand="Sakura">
                <img src="../src/participant3.webp" alt="Сакура кимоно">
                <div class="brand">Сакура</div>
            </div>

            <!-- The White Company кимоно -->
            <div class="card" data-brand="Satin">
                <img src="../src/participant4.webp" alt="Сатин кимоно">
                <div class="brand">Сатин</div>
            </div>

            <!-- OYSHO кимоно -->
            <div class="card" data-brand="Ladkih">
                <img src="../src/participant6.webp" alt="Вероника Ладких кимоно">
                <div class="brand">Вероника Ладких</div>
            </div>

            <!-- Любой другой -->
            <div class="card" data-brand="Calvin">
                <img src="../src/participant5.webp" alt="Кальвин кимоно">
                <div class="brand">Кальвин</div>
            </div>
        </div>

        <button class="btn" id="voteBtn" disabled>Проголосовать</button>
        <div class="thanks" id="thanks">Спасибо, красотка! ♡ Перенаправляю…</div>
        <div class="already-voted" id="alreadyVoted" style="display:none;">Вы уже проголосовали ♡ Спасибо!</div>
    </div>


<!-- Попап -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <h2 id="modalTitle">Авторизуйтесь для голосования</h2>
            <p id="modalText">Чтобы проголосовать, нужно войти через Telegram</p>
            <button class="modal-btn" id="modalClose">Ок</button>
        </div>
    </div>

<!-- modal -->
<div class="full-modal" id="fullModal">
    <div class="modal-wrapper">
        <!-- Крестик теперь внутри обёртки, над iframe -->
        <div class="close-full-modal" id="closeFullModal">×</div>
        
        <!-- iframe с контентом -->
        <iframe id="modalIframe" src="" allowfullscreen></iframe>
    </div>
</div>

    <script>
      const voteBtn = document.getElementById('voteBtn');
      const thanks = document.getElementById('thanks');
      const alreadyVotedMsg = document.getElementById('alreadyVoted');
      const cards = document.querySelectorAll('.card');

      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalText = document.getElementById('modalText');
      const modalClose = document.getElementById('modalClose');

      let selected = false;

      const fullModal = document.getElementById('fullModal');
    const modalIframe = document.getElementById('modalIframe');
    const closeFullModal = document.getElementById('closeFullModal');

    // Функция открытия нужной страницы как попап
    function openPageAsModal(url) {
        modalIframe.src = url;
        fullModal.classList.add('show');
        document.body.style.overflow = 'hidden'; // блокируем скролл фона
    }

    // Закрытие
    closeFullModal.onclick = () => {
        fullModal.classList.remove('show');
        modalIframe.src = '';
        document.body.style.overflow = '';
    };

    // Закрытие по клику на фон
    fullModal.onclick = (e) => {
        if (e.target === fullModal) {
            closeFullModal.click();
        }
    };

    // При загрузке страницы проверяем, есть ли уже данные о голосовании
    const userData = JSON.parse(localStorage.getItem('kimonoVoteUser'));
    if (userData && userData.isVoted === true) {
        // Уже голосовал
        voteBtn.disabled = true;
        voteBtn.textContent = 'Вы уже проголосовали ♡';
        alreadyVotedMsg.style.display = 'block';
        
        cards.forEach(card => card.style.pointerEvents = 'none');
    }

        // Выбор карточки
            cards.forEach(card => {
                card.addEventListener('click', () => {
                    if (userData?.isVoted) return;

                    cards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selected = card.getAttribute('data-brand');
                    voteBtn.disabled = false;
                })
              }
            );

          voteBtn.addEventListener('click', () => {
                  if (!selected || userData?.isVoted) return;
                  if(userData?.tg_phone){

                    modalTitle.textContent = "Спасибо за Ваш голос! ♡";
                    modalText.textContent = "Твой выбор сохранён";
                    showModal();

                        const voteData = {
                            tg_phone: userData?.tg_phone,         
                            isVoted: true,
                        };
                        localStorage.setItem('kimonoVoteUser', JSON.stringify(voteData));
                           thanks.style.opacity = 1;
                  voteBtn.disabled = true;
                  }
                  else{
                      setTimeout(() => {
                          openPageAsModal('/StartForm.html');
                      }, 100);
                  }
              });

          function showModal() {
            modal.classList.add('show');
        }

        // Закрытие по кнопке (если захочешь)
        modalClose.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        // Закрытие по клику вне окна
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
            }
        });

        window.addEventListener('message', (event) => {
        if (event.data.res === 'Ok') {
          
            document.getElementById('closeFullModal').click();

            modalTitle.textContent = "Спасибо за Ваш голос! ♡";
            modalText.textContent = "";
            showModal();

            voteBtn.disabled = true;
        }
        else if(event.data.res === 'Error'){
            document.getElementById('closeFullModal').click();

            modalTitle.textContent = "Ошибка ♡";
            modalText.textContent = event.data.msg;
            showModal();

            voteBtn.disabled = false;
        }
});
    </script>
</body>
</html>